# City Parameters Guide

Этот файл объясняет, какие параметры города влияют на мошенничество, обман, кражи и итоговую экономику.

## 1) Параметры, которые сильнее всего двигают fraud/dispute

- `crime_index`:
  - повышает `fraud_incident_rate`, `dispute_rate`, частично `refund_rate`.
  - чем выше индекс, тем выше риск злоупотреблений.

- `economic_stress_index`:
  - повышает вероятность спорных и токсичных кейсов.
  - увеличивает отмены, возвраты, фрод-попытки.

- `digital_fraud_pressure_index`:
  - описывает давление онлайн-мошенничества (мультиаккаунты, подозрительная активность).
  - увеличивает fraud/dispute и нагрузку на ручные проверки.

- `hotspot_inequality_index`:
  - моделирует районную неоднородность и локальные горячие зоны.
  - увеличивает риск инцидентов даже при умеренных средних значениях города.

- `anti_fraud_maturity_index`:
  - снижает fraud/dispute мультипликаторы.
  - чем выше зрелость контроля, тем ниже потери.

## 2) Параметры, которые влияют на сервис и косвенно на споры

- `traffic_congestion_index`:
  - повышает `late_delivery_rate`.
  - больше опозданий -> больше тикетов, возвратов и споров.

- `courier_reliability_index`:
  - снижает отмены, опоздания и ошибки исполнения.
  - влияет на качество операционки и уменьшает потери.

- `density_index`:
  - увеличивает сложность логистики в плотной застройке.
  - в комбинации с трафиком может повышать late/refund/dispute.

## 3) Параметры, которые влияют на чек и доход

- `income_index`:
  - повышает средний чек (`order_value_multiplier`) и стабильность оплат.
  - может увеличить выручку на заказ и снизить часть рисков.

- `tourism_index`:
  - увеличивает волатильность спроса и размер чека.
  - при слабой операционке может поднимать инциденты в пиковые периоды.

- `population_millions` + `market_share`:
  - определяют объем заказов в городе.
  - больше объем = выше абсолютные потери при том же rate.

## 4) Как это считается в Monte Carlo

На каждый день и для каждого city profile:

1. Базовые вероятности из `funnel` берутся как опорные.
2. К ним применяются city-specific мультипликаторы.
3. Сэмплирование идет через случайные величины:
   - количество заказов (Poisson)
   - события по воронке (Binomial)
4. Считаются деньги:
   - выручка
   - комиссии/операционные расходы
   - потери от refund/dispute
   - cash после reserve hold
5. Результаты агрегируются:
   - global отчет
   - отчет по каждому городу
   - city risk ranking

## 5) Практическая калибровка (если пока нет точных данных)

- Шаг 1: возьми базовые значения по умолчанию (в `config.json`).
- Шаг 2: сделай 3 профиля города:
  - `Calm` (низкие crime/stress/digital fraud)
  - `Base` (средние)
  - `Hot` (высокие crime/stress/hotspot)
- Шаг 3: прогоняй 3 сценария:
  - optimistic / base / stress
- Шаг 4: сравнивай:
  - `fraud_rate`, `dispute_rate`, `unit_net_profit_per_order`, `cash_after_reserve`
- Шаг 5: как только появятся реальные данные, подкручивай индексы и базовые rates.

## 6) На что смотреть в отчетах в первую очередь

- `unit_net_profit_per_delivered_order_usd`
- `dispute_rate`
- `fraud_rate`
- `loss_probability`
- `negative_cash_probability`
- `city_risk_ranking`

## 7) Быстрые правила интерпретации

- высокий `fraud_rate` + высокий `dispute_rate`:
  - проблема не только в сервисе, а в защитном контуре.

- высокий `late_rate` + высокий `refund_rate`:
  - операционка/логистика ломают экономику.

- нормальный revenue, но `unit_net_profit` отрицательный:
  - структура комиссий/потерь/процессора съедает маржу.

- один город резко хуже остальных:
  - включать city-specific ограничения, лимиты и ручной контроль по этому профилю.
