# Cost Simulation — Planning

**Назначение документа**
Сформировать план симуляции бухгалтерских и операционных затрат на одну доставку для OpenWok. Цель — понять, сколько реально стоит обслуживание одного заказа на стороне платформы (кросс‑сервис), и на основе этого выбрать модель тарифа: фиксированная плата за заказ, процент от заказа или гибрид.

**Краткое резюме задачи**
Нужно спроектировать (не кодить) симуляцию себестоимости обслуживания заказа: инфраструктура, карты, запросы, нейросеть, поддержка, персонал, обновления приложений, админ‑операции. Итогом должны быть формулы unit‑economics, сценарии min/avg/max и критерии выбора тарифа.

---

**1. Что нужно выяснить (ключевые вопросы)**
- Сколько стоит один заказ для платформы в среднем, минимуме и максимуме.
- Какие факторы сильнее всего влияют на cost per order.
- Как меняется стоимость при росте города, плотности заказов и частоты обновления трекинга.
- Как распределять фиксированные затраты по заказам.
- Какая тарифная модель дает устойчивую маржу и предсказуемость для ресторанов.

**2. Границы модели (что входит и что не входит)**
Входит:
- Инфраструктура и серверные ресурсы (API, БД, очереди, логи, мониторинг).
- Запросы к картам и геосервисам (геокодинг, роутинг, трекинг).
- Запросы к нейросетям (модерация, техобслуживание, антифрод‑сигналы, support‑бот).
- Коммуникации (push, SMS, email, голосовые уведомления).
- Поддержка пользователей и ресторанов (операторы, время обработки обращений).
- Персонал платформы (accounting, ops, devops, SRE, PM, support, legal, HR).
- Разработка и поддержка приложений (iOS/Android/web, обновления, совместимость).
- Прочие сервисы (аналитика, лог‑хранилища, A/B, CI/CD, мониторинг).

Не входит:
- Себестоимость еды, работа ресторана, выплаты курьерам, чаевые.
- Эквайринг/комиссия платежки, если в расчет тарифов она вынесена отдельно.
- Аренда офиса и бытовые расходы, если решим считать их отдельным блоком.

**3. Таксономия затрат (структура)**
**Переменные (на заказ):**
- Карты и геосервисы: геокодинг адреса, построение маршрута, обновления трекинга.
- Инфраструктура на запрос: API‑гейтвей, БД, кэш, очереди, CDN.
- Нейросеть: разовые вызовы на заказ, проверки, автоматизация техподдержки.
- Уведомления: push/SMS/email и ретраи.
- Поддержка: среднее время обработки обращения × ставка.
- Хранилище логов и треков за заказ.

**Фиксированные (на период):**
- Зарплаты персонала (включая бухгалтера и годовые пики отчетности).
- Поддержка и обновление приложений (iOS/Android/web).
- Инфраструктура базового уровня (минимальная емкость, мониторинг, резервирование).
- Юр./комплаенс расходы, безопасность, админ‑процессы.

**Полу‑переменные:**
- Серверные мощности, масштабируемые по пику заказов.
- Расходы на мониторинг/логирование, зависящие от объема.

**4. Переменные модели (входные параметры)**
- Количество заказов в день, неделе, месяце.
- Плотность заказов и распределение по районам.
- Средняя длительность доставки и длительность трекинга.
- Частота обновления трекинга (обновления/мин).
- Количество запросов к картам на один заказ.
- Количество push/SMS на один заказ.
- Доля заказов с обращениями в поддержку.
- Количество вызовов нейросети на заказ.
- Средняя нагрузка на API (запросов/заказ).
- Пиковая одновременность (конкурентность заказов).
- Размер города, трафик, сложность маршрутов.

**5. Формула расчета стоимости одного заказа**
Общий вид:
- **Cost per Order = VariableCost + FixedCostPerPeriod / OrdersPerPeriod**

Расшифровка переменной части:
- **VariableCost =**
- карты: (geo_requests + route_requests + tracking_updates) × cost_per_map_request
- инфраструктура: api_requests × cost_per_api_request
- нейросеть: ml_calls × cost_per_ml_call
- уведомления: (push_count × cost_per_push) + (sms_count × cost_per_sms)
- поддержка: support_minutes × cost_per_support_min
- хранение: data_gb_per_order × cost_per_gb

Фиксированные:
- **FixedCostPerPeriod =** зарплаты + базовая инфраструктура + обновления приложений + комплаенс
- **OrdersPerPeriod** — фактические заказы за тот же период

**6. География и масштаб (как влияют)**
- Большие города: больше светофоров, больше вариантов маршрута, выше плотность запросов к карте.
- Малые города: меньше запросов к маршрутизации, но выше доля фиксированных затрат на заказ.
- Пиковые часы: рост конкуренции за ресурсы и частоты обновления трекинга.
- Сложные районы: больше ретраев, больше обращений в поддержку.

**7. Сценарии симуляции**
Минимум:
- Низкая частота трекинга, минимум запросов к картам, редкие обращения в поддержку.

Средний сценарий:
- Типовой заказ, стандартная частота обновления трекинга, базовые уведомления.

Максимум:
- Длинный маршрут, частые обновления, дополнительные проверки нейросети, обращение в поддержку.

**8. Выбор тарифа (fixed vs percent vs hybrid)**
Критерии оценки:
- Маржинальность на заказ и устойчивость к пикам.
- Предсказуемость для ресторанов.
- Чувствительность к цене заказа (дешевые заказы vs дорогие).
- Минимально допустимая маржа при худшем сценарии.

Модели:
- **Fixed fee:** простота и прозрачность, но риск на дешевых/дорогих заказах.
- **Percent of order:** балансируется с размером заказа, но менее прозрачно.
- **Hybrid:** фикс + небольшой процент для покрытия хвоста затрат.

**9. Какие данные нужно собрать**
- Реальные или пилотные метрики по количеству запросов к картам и API на заказ.
- Частота обращений в поддержку и среднее время обработки.
- Трафик/заказы по времени суток и регионам.
- Нагрузочные профили инфраструктуры и стоимость масштабирования.
- Средняя длительность доставки и частота трекинга.

**10. Артефакты, которые должна выдать симуляция**
- Таблица cost per order: min/avg/max по сценариям и типам городов.
- Чувствительность затрат к ключевым параметрам.
- Рекомендации по тарифу (fixed/percent/hybrid) с обоснованием.
- Диапазон безопасной цены за заказ и порог безубыточности.

**11. План работ (без кода)**
- Уточнить перечень сервисов и операций в цепочке заказа.
- Описать модель затрат и зафиксировать входные параметры.
- Согласовать сценарии min/avg/max и модели городов.
- Зафиксировать список данных для пилота.
- Подготовить отчетный формат итогов.

---

**Открытые вопросы**
- Включаем ли комиссию платежки в тариф платформы или показываем отдельно.
- Как считать юридические расходы и комплаенс — фиксированно или на заказ.
- Какая базовая частота трекинга приемлема для UX и не взрывает cost.
- Нужны ли разные тарифы по городам или единая цена для всех.

**Готовый промпт для ChatGPT (если делегировать аналитику)**
```text
Ты — аналитик unit‑economics для OpenWok.
Задача: спроектировать (НЕ кодить) модель затрат на один заказ для платформы. Нужно определить все статьи затрат, разделить на переменные и фиксированные, задать ключевые параметры, описать сценарии min/avg/max и выдать рекомендации по тарифу (fixed/percent/hybrid).

Выходные данные:
1) Таксономия затрат.
2) Формулы cost per order.
3) Таблица ключевых параметров и типовые диапазоны.
4) Сценарии для малого/среднего/крупного города.
5) Рекомендации по тарифу.
6) Список данных, которые нужно собрать в пилоте.

Не программируй.
```
